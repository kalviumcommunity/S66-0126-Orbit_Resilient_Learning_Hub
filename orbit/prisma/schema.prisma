generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String     @id @default(cuid())
  name      String?
  email     String     @unique
  password  String     // To be hashed later in Auth module
  progress  Progress[]
  createdAt DateTime   @default(now())

  @@index([email]) // Optimize login/lookup queries
}

model Lesson {
  id          String     @id @default(cuid())
  title       String
  slug        String     @unique
  content     String     @db.Text // Store markdown for offline rendering
  order       Int        @default(0) // To order lessons correctly
  progress    Progress[]
  updatedAt   DateTime   @updatedAt

  @@index([slug])  // Optimize lesson lookup by slug
  @@index([order]) // Optimize ordered lesson queries
}

model Progress {
  id         String   @id @default(cuid())
  userId     String
  lessonId   String
  completed  Boolean  @default(false)
  score      Int?     // For quiz results
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson     Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  updatedAt  DateTime @updatedAt

  @@unique([userId, lessonId]) // One student can have only one progress entry per lesson
  @@index([userId])            // Optimize user progress queries
  @@index([completed])         // Optimize completion status queries
  @@index([userId, completed]) // Composite index for dashboard queries
}