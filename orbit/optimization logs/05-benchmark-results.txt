
> orbit@0.1.0 benchmark
> tsx scripts/benchmark-queries.ts

[dotenv@17.3.1] injecting env (3) from .env.local -- tip: âš™ï¸  override existing env vars with { override: true }
ğŸš€ Starting Performance Benchmarks

âš ï¸  Make sure the dev server is running (npm run dev)

ğŸ“‹ Step 1: Enrolling a test user...

âœ… User enrolled: cmlrwdsiz00145isbcujy1kl0
   Progress initialized: 10 lessons

ğŸ“Š Benchmark 1: Student Enrollment Transaction

   âœ… Enrollment Transaction: 18ms

ğŸ“Š Benchmark 2: Optimized Dashboard Query

   âŒ Dashboard (Optimized): 677ms

ğŸ“Š Benchmark 3: Unoptimized Dashboard Query (For Comparison)

   âŒ Dashboard (Unoptimized): 621ms

ğŸ“Š Benchmark 4: Lessons List

   âœ… Lessons List: 41ms

ğŸ“Š Benchmark 5: Lessons with User Progress

   âœ… Lessons with Progress: 14ms

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    BENCHMARK RESULTS                   
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… PASS Enrollment Transaction         18ms
âŒ FAIL Dashboard (Optimized)          677ms
âŒ FAIL Dashboard (Unoptimized)        621ms
âœ… PASS Lessons List                   41ms
âœ… PASS Lessons with Progress          14ms

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 OPTIMIZATION ANALYSIS                  
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Dashboard Query (Optimized):    677ms
Dashboard Query (Unoptimized):  621ms

ğŸ¯ Performance Improvement:      -9.0%
âš¡ Speed Multiplier:              0.9x faster

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   KEY TAKEAWAYS                        
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Optimizations Applied:
   â€¢ Single query with nested select (no N+1)
   â€¢ Field selection (no over-fetching)
   â€¢ Index usage on userId and lesson.order
   â€¢ Client-side aggregation

âŒ Anti-patterns Avoided:
   â€¢ Multiple separate queries (N+1 problem)
   â€¢ Over-fetching with include: true
   â€¢ Full table scans without indexes
   â€¢ Unnecessary data transfer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

