
> orbit@0.1.0 dev
> next dev

â–² Next.js 16.1.6 (Turbopack)
- Local:         http://localhost:3000
- Network:       http://10.34.45.192:3000
- Environments: .env.local

âœ“ Starting...
âœ“ Ready in 469ms
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","score","updatedAt") VALUES ($1,$2,$3,$4,$5,$6), ($7,$8,$9,$10,$11,$12), ($13,$14,$15,$16,$17,$18), ($19,$20,$21,$22,$23,$24), ($25,$26,$27,$28,$29,$30), ($31,$32,$33,$34,$35,$36), ($37,$38,$39,$40,$41,$42), ($43,$44,$45,$46,$47,$48), ($49,$50,$51,$52,$53,$54), ($55,$56,$57,$58,$59,$60)
prisma:query COMMIT
 POST /api/users/enroll 201 in 261ms (compile: 133ms, render: 128ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","score","updatedAt") VALUES ($1,$2,$3,$4,$5,$6), ($7,$8,$9,$10,$11,$12), ($13,$14,$15,$16,$17,$18), ($19,$20,$21,$22,$23,$24), ($25,$26,$27,$28,$29,$30), ($31,$32,$33,$34,$35,$36), ($37,$38,$39,$40,$41,$42), ($43,$44,$45,$46,$47,$48), ($49,$50,$51,$52,$53,$54), ($55,$56,$57,$58,$59,$60)
prisma:query COMMIT
 POST /api/users/enroll 201 in 24ms (compile: 3ms, render: 20ms)
prisma:error 
Invalid `tx.user.create()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__1b57a763._.js:125:43

  122 // Transaction: Create user + initialize all progress records atomically
  123 const result = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].$transaction(async (tx)=>{
  124     // Step 1: Create the user
â†’ 125     const newUser = await tx.user.create(
Unique constraint failed on the fields: (`email`)
prisma:query ROLLBACK
Enrollment transaction failed: Error [PrismaClientKnownRequestError]: 
Invalid `tx.user.create()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__1b57a763._.js:125:43

  122 // Transaction: Create user + initialize all progress records atomically
  123 const result = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].$transaction(async (tx)=>{
  124     // Step 1: Create the user
â†’ 125     const newUser = await tx.user.create(
Unique constraint failed on the fields: (`email`)
    at <unknown> (src/app/api/users/enroll/route.ts:40:37)
    at async (src/app/api/users/enroll/route.ts:40:23)
    at async POST (src/app/api/users/enroll/route.ts:38:20)
  38 |     const result = await prisma.$transaction(async (tx) => {
  39 |       // Step 1: Create the user
> 40 |       const newUser = await tx.user.create({
     |                                     ^
  41 |         data: {
  42 |           name,
  43 |           email, {
  code: 'P2002',
  meta: [Object],
  clientVersion: '7.4.0'
}
 POST /api/users/enroll 409 in 179ms (compile: 1391Âµs, render: 177ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","score","updatedAt") VALUES ($1,$2,$3,$4,$5,$6), ($7,$8,$9,$10,$11,$12), ($13,$14,$15,$16,$17,$18), ($19,$20,$21,$22,$23,$24), ($25,$26,$27,$28,$29,$30), ($31,$32,$33,$34,$35,$36), ($37,$38,$39,$40,$41,$42), ($43,$44,$45,$46,$47,$48), ($49,$50,$51,$52,$53,$54), ($55,$56,$57,$58,$59,$60)
prisma:query COMMIT
 POST /api/users/enroll 201 in 19ms (compile: 3ms, render: 17ms)
prisma:query SELECT "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt" FROM "public"."User" WHERE ("public"."User"."email" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:error 
Invalid `tx.user.create()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__a3a6af96._.js:157:27

  154     });
  155 }
  156 // This should fail due to unique constraint
â†’ 157 await tx.user.create(
Unique constraint failed on the fields: (`email`)
prisma:query ROLLBACK
prisma:query SELECT COUNT(*) AS "_count$_all" FROM (SELECT "public"."User"."id" FROM "public"."User" WHERE "public"."User"."email" = $1 OFFSET $2) AS "sub"
 GET /api/test/transaction-rollback?case=duplicate-email 200 in 55ms (compile: 29ms, render: 26ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:error 
Invalid `tx.progress.create()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__a3a6af96._.js:195:31

  192     }
  193 });
  194 // Try to create progress with non-existent lesson ID
â†’ 195 await tx.progress.create(
Foreign key constraint violated on the constraint: `Progress_lessonId_fkey`
prisma:query ROLLBACK
prisma:query SELECT "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt" FROM "public"."User" WHERE ("public"."User"."email"::text LIKE ('%' || $1 || '%') AND NOT EXISTS(SELECT "t0"."userId" FROM "public"."Progress" AS "t0" WHERE (1=1 AND ("public"."User"."id") = ("t0"."userId") AND "t0"."userId" IS NOT NULL))) OFFSET $2
 GET /api/test/transaction-rollback?case=invalid-foreign-key 200 in 36ms (compile: 7ms, render: 28ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id", "public"."Lesson"."title", "public"."Lesson"."slug", "public"."Lesson"."content", "public"."Lesson"."order", "public"."Lesson"."updatedAt" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","updatedAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."Progress"."id", "public"."Progress"."userId", "public"."Progress"."lessonId", "public"."Progress"."completed", "public"."Progress"."score", "public"."Progress"."updatedAt"
prisma:query ROLLBACK
prisma:query SELECT "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt" FROM "public"."User" WHERE ("public"."User"."email" = $1 AND 1=1) LIMIT $2 OFFSET $3
 GET /api/test/transaction-rollback?case=manual-throw 200 in 35ms (compile: 3ms, render: 32ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","score","updatedAt") VALUES ($1,$2,$3,$4,$5,$6), ($7,$8,$9,$10,$11,$12), ($13,$14,$15,$16,$17,$18), ($19,$20,$21,$22,$23,$24), ($25,$26,$27,$28,$29,$30), ($31,$32,$33,$34,$35,$36), ($37,$38,$39,$40,$41,$42), ($43,$44,$45,$46,$47,$48), ($49,$50,$51,$52,$53,$54), ($55,$56,$57,$58,$59,$60)
prisma:query COMMIT
 POST /api/users/enroll 201 in 22ms (compile: 1337Âµs, render: 20ms)
prisma:query INSERT INTO "public"."User" ("id","name","email","password","createdAt") VALUES ($1,$2,$3,$4,$5) RETURNING "public"."User"."id", "public"."User"."name", "public"."User"."email", "public"."User"."password", "public"."User"."createdAt"
prisma:query SELECT "public"."Lesson"."id" FROM "public"."Lesson" WHERE 1=1 OFFSET $1
prisma:query INSERT INTO "public"."Progress" ("id","userId","lessonId","completed","score","updatedAt") VALUES ($1,$2,$3,$4,$5,$6), ($7,$8,$9,$10,$11,$12), ($13,$14,$15,$16,$17,$18), ($19,$20,$21,$22,$23,$24), ($25,$26,$27,$28,$29,$30), ($31,$32,$33,$34,$35,$36), ($37,$38,$39,$40,$41,$42), ($43,$44,$45,$46,$47,$48), ($49,$50,$51,$52,$53,$54), ($55,$56,$57,$58,$59,$60)
prisma:query COMMIT
 POST /api/users/enroll 201 in 15ms (compile: 1440Âµs, render: 13ms)
Error: Route "/api/users/[userId]/dashboard" used `params.userId`. `params` is a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
    at GET (src/app/api/users/[userId]/dashboard/route.ts:20:13)
  18 | ) {
  19 |   try {
> 20 |     const { userId } = params;
     |             ^
  21 |
  22 |     // Single optimized query: Fetch user with all progress in one database call
  23 |     const dashboardData = await prisma.user.findUnique({
prisma:error 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__ab131329._.js:106:171

  103 try {
  104     const { userId } = params;
  105     // Single optimized query: Fetch user with all progress in one database call
â†’ 106     const dashboardData = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
            where: {
              id: undefined,
          ?   email?: String,
          ?   AND?: UserWhereInput | UserWhereInput[],
          ?   OR?: UserWhereInput[],
          ?   NOT?: UserWhereInput | UserWhereInput[],
          ?   name?: StringNullableFilter | String | Null,
          ?   password?: StringFilter | String,
          ?   createdAt?: DateTimeFilter | DateTime,
          ?   progress?: ProgressListRelationFilter
            },
            select: {
              id: true,
              name: true,
              email: true,
              createdAt: true,
              progress: {
                select: {
                  id: true,
                  completed: true,
                  score: true,
                  updatedAt: true,
                  lesson: {
                    select: {
                      id: true,
                      title: true,
                      slug: true,
                      order: true
                    }
                  }
                },
                orderBy: {
                  lesson: {
                    order: "asc"
                  }
                }
              }
            }
          })

Argument `where` of type UserWhereUniqueInput needs at least one of `id` or `email` arguments. Available options are marked with ?.
Dashboard query failed: Error [PrismaClientValidationError]: 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__ab131329._.js:106:171

  103 try {
  104     const { userId } = params;
  105     // Single optimized query: Fetch user with all progress in one database call
â†’ 106     const dashboardData = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
            where: {
              id: undefined,
          ?   email?: String,
          ?   AND?: UserWhereInput | UserWhereInput[],
          ?   OR?: UserWhereInput[],
          ?   NOT?: UserWhereInput | UserWhereInput[],
          ?   name?: StringNullableFilter | String | Null,
          ?   password?: StringFilter | String,
          ?   createdAt?: DateTimeFilter | DateTime,
          ?   progress?: ProgressListRelationFilter
            },
            select: {
              id: true,
              name: true,
              email: true,
              createdAt: true,
              progress: {
                select: {
                  id: true,
                  completed: true,
                  score: true,
                  updatedAt: true,
                  lesson: {
                    select: {
                      id: true,
                      title: true,
                      slug: true,
                      order: true
                    }
                  }
                },
                orderBy: {
                  lesson: {
                    order: "asc"
                  }
                }
              }
            }
          })

Argument `where` of type UserWhereUniqueInput needs at least one of `id` or `email` arguments. Available options are marked with ?.
    at <unknown> (src/app/api/users/[userId]/dashboard/route.ts:23:45)
    at async GET (src/app/api/users/[userId]/dashboard/route.ts:23:27)
  21 |
  22 |     // Single optimized query: Fetch user with all progress in one database call
> 23 |     const dashboardData = await prisma.user.findUnique({
     |                                             ^
  24 |       where: { id: userId },
  25 |       select: {
  26 |         id: true, {
  clientVersion: '7.4.0'
}
 GET /api/users/cmlrwdsiz00145isbcujy1kl0/dashboard 500 in 673ms (compile: 488ms, render: 185ms)
Error: Route "/api/users/[userId]/dashboard-unoptimized" used `params.userId`. `params` is a Promise and must be unwrapped with `await` or `React.use()` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis
    at GET (src/app/api/users/[userId]/dashboard-unoptimized/route.ts:22:13)
  20 | ) {
  21 |   try {
> 22 |     const { userId } = params;
     |             ^
  23 |
  24 |     // ANTI-PATTERN 1: Separate query for user (first database call)
  25 |     const user = await prisma.user.findUnique({
prisma:error 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__7e978dd8._.js:106:162

  103 try {
  104     const { userId } = params;
  105     // ANTI-PATTERN 1: Separate query for user (first database call)
â†’ 106     const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
            where: {
              id: undefined,
          ?   email?: String,
          ?   AND?: UserWhereInput | UserWhereInput[],
          ?   OR?: UserWhereInput[],
          ?   NOT?: UserWhereInput | UserWhereInput[],
          ?   name?: StringNullableFilter | String | Null,
          ?   password?: StringFilter | String,
          ?   createdAt?: DateTimeFilter | DateTime,
          ?   progress?: ProgressListRelationFilter
            }
          })

Argument `where` of type UserWhereUniqueInput needs at least one of `id` or `email` arguments. Available options are marked with ?.
Dashboard query failed: Error [PrismaClientValidationError]: 
Invalid `__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique()` invocation in
/home/aryan/S66-0126-Orbit_Resilient_Learning_Hub/orbit/.next/dev/server/chunks/[root-of-the-server]__7e978dd8._.js:106:162

  103 try {
  104     const { userId } = params;
  105     // ANTI-PATTERN 1: Separate query for user (first database call)
â†’ 106     const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
            where: {
              id: undefined,
          ?   email?: String,
          ?   AND?: UserWhereInput | UserWhereInput[],
          ?   OR?: UserWhereInput[],
          ?   NOT?: UserWhereInput | UserWhereInput[],
          ?   name?: StringNullableFilter | String | Null,
          ?   password?: StringFilter | String,
          ?   createdAt?: DateTimeFilter | DateTime,
          ?   progress?: ProgressListRelationFilter
            }
          })

Argument `where` of type UserWhereUniqueInput needs at least one of `id` or `email` arguments. Available options are marked with ?.
    at <unknown> (src/app/api/users/[userId]/dashboard-unoptimized/route.ts:25:36)
    at async GET (src/app/api/users/[userId]/dashboard-unoptimized/route.ts:25:18)
  23 |
  24 |     // ANTI-PATTERN 1: Separate query for user (first database call)
> 25 |     const user = await prisma.user.findUnique({
     |                                    ^
  26 |       where: { id: userId },
  27 |       // Over-fetching: Gets all user fields even though we don't need all
  28 |     }); {
  clientVersion: '7.4.0'
}
 GET /api/users/cmlrwdsiz00145isbcujy1kl0/dashboard-unoptimized 500 in 616ms (compile: 480ms, render: 137ms)
prisma:query SELECT "public"."Lesson"."id", "public"."Lesson"."title", "public"."Lesson"."slug", "public"."Lesson"."order", "public"."Lesson"."updatedAt" FROM "public"."Lesson" WHERE 1=1 ORDER BY "public"."Lesson"."order" ASC OFFSET $1
 GET /api/lessons 200 in 39ms (compile: 27ms, render: 11ms)
prisma:query SELECT "public"."Lesson"."id", "public"."Lesson"."title", "public"."Lesson"."slug", "public"."Lesson"."order", "public"."Lesson"."updatedAt" FROM "public"."Lesson" WHERE 1=1 ORDER BY "public"."Lesson"."order" ASC OFFSET $1
prisma:query SELECT "public"."Progress"."id", "public"."Progress"."completed", "public"."Progress"."score", "public"."Progress"."updatedAt", "public"."Progress"."lessonId" FROM "public"."Progress" WHERE ("public"."Progress"."userId" = $1 AND "public"."Progress"."lessonId" IN ($2,$3,$4,$5,$6,$7,$8,$9,$10,$11)) OFFSET $12
 GET /api/lessons?userId=cmlrwdsiz00145isbcujy1kl0 200 in 12ms (compile: 1150Âµs, render: 10ms)
[?25h
